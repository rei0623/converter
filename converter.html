<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro Markdown Editor & Converter</title>

    <!-- marked.js (Markdown -> HTML) -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- CodeMirror (È´òÊ©üËÉΩ„Ç®„Éá„Ç£„Çø) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.css">
    <!-- CodeMirror „ÉÜ„Éº„Éû („É©„Ç§„Éà„É¢„Éº„ÉâÁî®) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/base16-light.min.css">
    <!-- CodeMirror „ÉÜ„Éº„Éû („ÉÄ„Éº„ÇØ„É¢„Éº„ÉâÁî®) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/material-darker.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/markdown/markdown.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/display/placeholder.min.js"></script>

    <style>
        /* --- Âü∫Êú¨„Çπ„Çø„Ç§„É´„Å®CSSÂ§âÊï∞ --- */
        :root {
            --bg-color: #f4f7f9;
            --text-color: #333;
            --container-bg: #fff;
            --border-color: #d1d5db;
            --header-color: #2c3e50;
            --sub-text-color: #7f8c8d;
            --preview-bg: #fdfdfd;
            --button-bg: #3498db;
            --button-hover-bg: #2980b9;
            --editor-theme: 'base16-light';
        }

        body.dark-mode {
            --bg-color: #2c3e50;
            --text-color: #ecf0f1;
            --container-bg: #34495e;
            --border-color: #4a5568;
            --header-color: #ecf0f1;
            --sub-text-color: #bdc3c7;
            --preview-bg: #2d343b;
            --button-bg: #e67e22;
            --button-hover-bg: #d35400;
            --editor-theme: 'material-darker';
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            transition: background-color 0.3s, color 0.3s;
        }

        .container {
            width: 90%;
            max-width: 1400px; /* Â∞ë„ÅóÂπÖ„ÇíÂ∫É„Åí„Çã */
            background-color: var(--container-bg);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            padding: 20px;
            transition: background-color 0.3s;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 15px;
            margin-bottom: 20px;
        }
        
        header .title-group { text-align: left; }
        h1 { color: var(--header-color); margin: 0; font-size: 1.8rem; }
        header p { color: var(--sub-text-color); font-size: 1rem; margin: 5px 0 0; }

        .main-content { display: flex; gap: 20px; }
        .panel { flex: 1; display: flex; flex-direction: column; }
        .panel label { font-weight: bold; margin-bottom: 8px; color: var(--header-color); }

        /* CodeMirror„Ç®„Éá„Ç£„Çø„ÅÆ„Çπ„Çø„Ç§„É´ */
        .CodeMirror {
            height: 65vh;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 16px;
        }
        .CodeMirror-placeholder {
            color: #999 !important;
        }

        .editor-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: var(--sub-text-color);
            padding: 5px 10px;
            background-color: var(--preview-bg);
            border: 1px solid var(--border-color);
            border-top: none;
            border-bottom-left-radius: 6px;
            border-bottom-right-radius: 6px;
        }

        .preview-area {
            height: calc(65vh + 34px); /* „Ç®„Éá„Ç£„Çø„Å®„Éï„ÉÉ„Çø„Éº„ÅÆÈ´ò„Åï„ÇíÂêà„Çè„Åõ„Çã */
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            overflow-y: auto;
            background-color: var(--preview-bg);
            color: var(--text-color);
        }
        
        .actions-toolbar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; flex-wrap: wrap; gap: 10px;}
        .toolbar button, .actions button, #darkModeToggle {
            background-color: var(--button-bg); color: white; border: none; padding: 8px 15px; font-size: 14px;
            border-radius: 5px; cursor: pointer; transition: background-color 0.3s, transform 0.1s;
        }
        .toolbar button:hover, .actions button:hover, #darkModeToggle:hover { background-color: var(--button-hover-bg); }
        #clearButton { background-color: #e74c3c; }
        #clearButton:hover { background-color: #c0392b; }
        #copyButton.copied { background-color: #2ecc71; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="title-group">
                <h1>Pro Markdown Editor</h1>
                <p>„Ç∑„É≥„Çø„ÉÉ„ÇØ„Çπ„Éè„Ç§„É©„Ç§„ÉàÂØæÂøú„ÄÇË¶ã„Åü„Åæ„Åæ„Ç≥„Éî„Éº„ÇÇÂèØËÉΩ„Åß„Åô„ÄÇ</p>
            </div>
            <button id="darkModeToggle">üåô „ÉÄ„Éº„ÇØ„É¢„Éº„Éâ</button>
        </header>
        
        <div class="main-content">
            <div class="panel">
                <div class="actions-toolbar">
                    <div class="toolbar">
                        <button data-action="bold"><b>B</b></button>
                        <button data-action="italic"><i>I</i></button>
                        <button data-action="link">Link</button>
                        <button data-action="list-ul">- List</button>
                        <button data-action="list-ol">1. List</button>
                        <button data-action="code">`Code`</button>
                    </div>
                    <button id="clearButton">„Åô„Åπ„Å¶„ÇØ„É™„Ç¢</button>
                </div>
                <!-- CodeMirror„Åå„Åì„ÅÆdiv„Çí„Ç®„Éá„Ç£„Çø„Å´ÁΩÆ„ÅçÊèõ„Åà„Çã -->
                <div id="editor-container"></div>
                <div class="editor-footer">
                    <div id="status-info">Markdown</div>
                    <div id="counter">ÊñáÂ≠óÊï∞: 0 | ÂçòË™ûÊï∞: 0</div>
                </div>
            </div>
            <div class="panel">
                <label>„Éó„É¨„Éì„É•„Éº</label>
                <div id="html-output" class="preview-area"></div>
            </div>
        </div>

        <div class="actions" style="text-align: center; margin-top: 20px;">
            <button id="copyButton" style="padding: 12px 25px; font-size: 16px; font-weight: bold;">Ë¶ã„Åü„Åæ„Åæ„ÅÆÂΩ¢Âºè„Åß„Ç≥„Éî„Éº</button>
        </div>
    </div>

    <script>
        // --- Ë¶ÅÁ¥†ÂèñÂæó ---
        const htmlOutput = document.getElementById('html-output');
        const copyButton = document.getElementById('copyButton');
        const darkModeToggle = document.getElementById('darkModeToggle');
        const clearButton = document.getElementById('clearButton');
        const toolbar = document.querySelector('.toolbar');
        const counterElement = document.getElementById('counter');

        let editor; // CodeMirror„Ç§„É≥„Çπ„Çø„É≥„Çπ„Çí‰øùÊåÅ„Åô„ÇãÂ§âÊï∞

        // --- Èñ¢Êï∞ÂÆöÁæ© ---
        const updatePreview = (content) => {
            htmlOutput.innerHTML = marked.parse(content);
        };

        const updateCounter = (content) => {
            const charCount = content.length;
            const wordCount = content.split(/\s+/).filter(Boolean).length;
            counterElement.textContent = `ÊñáÂ≠óÊï∞: ${charCount} | ÂçòË™ûÊï∞: ${wordCount}`;
        };

        const saveContent = (content) => {
            localStorage.setItem('markdownContent', content);
        };

        const applyStyle = (action) => {
            const selection = editor.getSelection();
            let replacement = '';
            switch (action) {
                case 'bold': replacement = `**${selection}**`; break;
                case 'italic': replacement = `*${selection}*`; break;
                case 'link':
                    const url = prompt('„É™„É≥„ÇØÂÖà„ÅÆURL„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ:', 'https://');
                    if (url) replacement = `[${selection || '„É™„É≥„ÇØ„ÉÜ„Ç≠„Çπ„Éà'}](${url})`;
                    else return;
                    break;
                case 'list-ul': replacement = `- ${selection}`; break;
                case 'list-ol': replacement = `1. ${selection}`; break;
                case 'code': replacement = `\`${selection}\``; break;
            }
            editor.replaceSelection(replacement, 'end');
            editor.focus();
        };
        
        const initEditor = (isDark) => {
            const container = document.getElementById('editor-container');
            container.innerHTML = ''; // Êó¢Â≠ò„ÅÆ„Ç®„Éá„Ç£„Çø„Çí„ÇØ„É™„Ç¢

            editor = CodeMirror(container, {
                value: localStorage.getItem('markdownContent') || '',
                mode: 'markdown',
                theme: isDark ? 'material-darker' : 'base16-light',
                lineNumbers: true,
                lineWrapping: true,
                autofocus: true,
                placeholder: '# „Çà„ÅÜ„Åì„ÅùÔºÅ\n„Åì„Åì„Å´Markdown„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ...'
            });

            editor.on('change', (cm) => {
                const content = cm.getValue();
                updatePreview(content);
                updateCounter(content);
                saveContent(content);
            });

            // ÂàùÊúüË°®Á§∫„ÅÆÊõ¥Êñ∞
            const initialContent = editor.getValue();
            updatePreview(initialContent);
            updateCounter(initialContent);
        };

        // --- „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº ---
        clearButton.addEventListener('click', () => {
            if (confirm('ÂÖ•ÂäõÂÜÖÂÆπ„Çí„Åô„Åπ„Å¶Ê∂àÂéª„Åó„Åæ„Åô„ÅãÔºü')) {
                editor.setValue('');
                editor.focus();
            }
        });

        toolbar.addEventListener('click', (e) => {
            if (e.target.tagName === 'BUTTON') {
                const action = e.target.dataset.action;
                if (action) applyStyle(action);
            }
        });

        darkModeToggle.addEventListener('click', () => {
            const isCurrentlyDark = document.body.classList.contains('dark-mode');
            document.body.classList.toggle('dark-mode');
            const isNowDark = !isCurrentlyDark;

            localStorage.setItem('darkMode', isNowDark);
            darkModeToggle.textContent = isNowDark ? '‚òÄÔ∏è „É©„Ç§„Éà„É¢„Éº„Éâ' : 'üåô „ÉÄ„Éº„ÇØ„É¢„Éº„Éâ';
            
            // „Ç®„Éá„Ç£„Çø„ÅÆ„ÉÜ„Éº„Éû„ÇíÂãïÁöÑ„Å´Â§âÊõ¥
            editor.setOption('theme', isNowDark ? 'material-darker' : 'base16-light');
        });

        copyButton.addEventListener('click', async () => {
            try {
                const htmlToCopy = htmlOutput.innerHTML;
                const textToCopy = htmlOutput.innerText;
                const htmlBlob = new Blob([htmlToCopy], { type: 'text/html' });
                const textBlob = new Blob([textToCopy], { type: 'text/plain' });
                const clipboardItem = new ClipboardItem({
                    'text/html': htmlBlob,
                    'text/plain': textBlob,
                });
                await navigator.clipboard.write([clipboardItem]);
                const originalText = copyButton.textContent;
                copyButton.textContent = '„Ç≥„Éî„Éº„Åó„Åæ„Åó„ÅüÔºÅ';
                copyButton.classList.add('copied');
                setTimeout(() => {
                    copyButton.textContent = originalText;
                    copyButton.classList.remove('copied');
                }, 2000);
            } catch (err) {
                console.error('„ÇØ„É™„ÉÉ„Éó„Éú„Éº„Éâ„Å∏„ÅÆ„Ç≥„Éî„Éº„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ', err);
                alert('„Ç≥„Éî„Éº„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ');
            }
        });

        // --- ÂàùÊúüÂåñÂá¶ÁêÜ ---
        document.addEventListener('DOMContentLoaded', () => {
            const savedDarkMode = localStorage.getItem('darkMode') === 'true';
            if (savedDarkMode) {
                document.body.classList.add('dark-mode');
                darkModeToggle.textContent = '‚òÄÔ∏è „É©„Ç§„Éà„É¢„Éº„Éâ';
            }
            initEditor(savedDarkMode);
        });
    </script>
</body>
</html>